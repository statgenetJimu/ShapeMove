ver4.0(今使っているversion)のマニュアル
http://www.torontomicrofluidics.ca/cms/manuals/niselements.pdf

ROIの自動検出(マニュアルP99)
[ROI]、[Simple ROI editor] [Edit ROIs in Time](P98 6.5.5)で使える。
[Simple ROI editor]で出てきたツールバー中の[Auto Detect All]をクリックするとROIの一斉検出ができる。
左クリックをするとその場所を含むROIができる。右クリックで決定。
決定したROIは掴んで動かせる。
マウスホイールをスクロール(もしくはPage up,Page down)することでROIの範囲を調節することができる。Cで凹部をなめらかにし、Oで凸部をなめらかにできる。SもしくはPで分割することができる(基準はよく分からない)。

ROIをBinaryに変える
[ROI]->[Swap Binary with ROI]でできる。ただし実行時に表示されているフレームに対してしか出来ない。

ROIをpngファイルで出力する
[ROI]->[Save ROI As]でファイルの種類としてpngを選ぶ。

ROIの自動追跡
Tracking(P160 9.18)
[View]->[Analysis Contorols]->[Tracking]
[Tracikng]コントロールウィンドウを使えば生きている細胞など動くものを自動で測定できる。
[Define New ROI](Trackingウィンドウ左上）でSimple ROI Editorのツールバーが開き、ROIが作成できる。作成したROIの情報はTrackingウィンドウに読み込まれる。ツールバーを消すとTrackingウィンドウが操作できるようになる。[Track Autodetected ROIs]でROIの追跡が始まる。
ROIが大きく動く場合はROIの追跡画面が止まることがある。その時は、ドラッグできる点があるのでそれをROIで囲みたい対象の異動先に持って行って[Track Autodetected ROIs]をクリックすればまた追跡が再開する。
出力したいROIを選択した状態で[Export](Trackingウィンドウ右上)->[Data to Excel]でExcelにデータを出力できる。
画面にROIが反映されている状態で[File]->[Save As]でROIの情報付きnd2ファイルが出力できる。

３次元画像の表示
[View]->[Image]->[Volume View](もしくは画像ウィンドウの虫眼鏡っぽいマーク)で表示できる。

動くROIを設定する
作成したROIを右クリックして、ROIs change over Timeにチェックを入れる（ROIs are Globalだと動画中動かないROIが設定される）。動画を動かして対象がROIから出るようであれば、動画を止めてROIを動かす。同様の作業を繰り返す。ROIの位置に変更を加えたフレーム間ではROIは等速で動く。軌跡はスムージングされている。

Edit ROI in time
[Edit ROIs in time]コマンドから行う。このコマンドは右のimage toolbarの[Turn ROI on/off]ボタンのcontextual menuからアクセスできると書いてあったが、contextual menuの中にそのようなものはなかった。Local Optionが入っていないのが原因?([Tracking]と[Local Option]が必要らしい(p98))

Local Option
Edit ROIs in Timeなどに必要。
NIS-Elementをインストールするときにインストールするかどうか選択できる(P2)。後からインストールする場合は[Start menu > Programs > NIS-Elements AR]に行き、[Modify installation]コマンドを選び、installation wizardの指示に従って加えたいアイテムのチェックボックスをオンにして、インストールを終える。

_ND_Export
Exportしたいnd2ファイルを開いた状態でコマンドラインを開き、”c:¥program Files¥NIS-Elements¥nis_ar.exe” -c “_ND_Export();”と打って実行すると出力用ウィンドウが開く。
[File]->[Import/Export]->[Export ND Document]でも出力用ウィンドウは開く。”_ND_ExportToTIFF();”コマンドというのもあるらしいが使えなかった（原因不明）。
ND Exportの時にInsert Overlaysにチェックを入れると出力された画像にROIも出力される。ただ、そのまま出力すると出力ファイルにはROIのラベルと移動の軌跡も一緒に出力されてしまう。
ROIのラベル番号はROIを右クリックして[ROI properties]を開き、Show Labelsのチェックを外せば消える。
軌跡を消すにはTrackingウィンドウを開いて目的のROIを右クリックし、[Unselect All]を選ぶ。すると、軌跡と中の塗りつぶしが消える。
中に中心を表す十字マークが表示されているようであればそれも消す必要がある。方法は歯車のマークをクリックし、Tracking Optionsが開く。[Display]タブをクリックし、[Show centroid]のチェックを外し、また下に5つ並んでいるチェックボックスのうち[Show only selected tracks]のみが選択された状態にする。
バイナリ化は[Binary]->[Define Threshold]でDifine Thresholdウィンドウを開いて、Saveコマンドの左にあるFull Image/Use ROIコマンド(ROIのマーク)をクリックして有効にする。(これで再生をすると警告が出るが意味がよくわからなかったのでYesを選択した。今の所問題は出ていない。)画像ウィンドウの右に並んでいるコマンドから[Turn ROI On/Off](ROIのマーク)を選んでをEnable Dynamic Threshold(画像ウィンドウ中の上に並んでいるアイコンの一つ)を押してもできる。ROI内とROIの輪郭の色が異なるのが気になる場合はROIを右クリックして[ROI Properties]から輪郭の色を赤に変えれば良い。変更はROI Propertiesにある上の方の色指定部分からできる。
バイナリ化を各フレームごとに行うためにはThresholdを動画ファイルに適用している段階でPreviewのチェックボックスをOnにしておく必要がある。チェックボックスがOnになっているフレームでのみROIが更新されるので、一番初めに作業をする際はあらかじめ別の画像ファイルを使うなどしてチェックボックスをOnにしておく必要がある。

Exportした画像はそのうち１枚をNIS-elementで開くとnd2形式の動画ファイルに変換するかを聞かれるので、Yesでnd2動画ファイルも作成することができる。

Exportしたファイルで気になる点
・元の動画に比べて動きがカクカクしている。
元の動画の全フレームについてではなく数フレームにつき一枚が抜き出されてExportされている？
ただ特にExport時にそれについて設定できるようなパラメーターはない。
・ROIが正確ではない
ROIで囲っている範囲外に細胞が飛び出していたり、逆にROIで囲われている中にも細胞のない部分が存在する。
山田先生に問題になるかどうかを判断してもらう。
・バイナリ化が正確に行われない
ROIにバイナリ化を適用しているはずだが、バイナリ部分がROIからはみ出していたり、その逆が起きたりする。どうもコマ送りにするとROIに1フレーム遅れてバイナリが反映されている。
ただ、出力されたtifファイルを改めてNIS-elementでnd2に変換しながら開いてみると、バイナリ化は正確になされている。
こちらについては動きがカクカクするということもないので、バイナリ化して出力したファイルは正確なバイナリ情報を持っているのかもしれない。

ZT変換
変換したいファイルを一度[File]->[Import/Export]->[Export ND Document]でTIFかjpegに変換する(jpegへの変換は非常に時間が掛かる)。この時に出てきたウィンドウのIndex orderをt,zの並びからz,t変える。次に[File]->[Open]で先ほど変換したファイルの中一枚を選ぼうとすると「この画像を含む一連のデータをND Documentに変換するか？」とダイアログボックスが出てくるので[Convert]を選択。Define Manuallyを選択した状態で下のTime、Z seriesの順にして読み込むとデータラベルが逆転する。開いたファイルを[File]->[Save As]から保存すればZとTが入れ替わったnd2の動画データができる。

以降やること
・全自動ROI検出の正確化
画面中のROIを一気に全部検出する機能があるのだが、これだと目的の細胞よりはるかに大きい塊を一斉に検出してしまうなど正確でない。パラメータをいじることで正確にできるのであればそれを行う。ただ難しそうなのでROIの検出は手動でやったほうがいいかもしれない。
・自動追跡だけでは追い切れない細胞が多いので、手動で修正を加える方法をマニュアル化する。
追跡している細胞が一気に動く場合や、何か手前の物体（例えば血管など）に隠れて一度画面から消える場合など、その後追跡することが難しい。そのような場合は手動で追跡に補正をかける必要がある。補正をかける機能があるのは分かっているが、方法とその性能がわからないのでその部分を調べる。
・マクロ化

マクロ化
Macro->recordで記録できる。
Historyから作成することもできる。
Writing/Editing a Macroから作成、編集することもできる。
ただ画像にROIを重ねてExportする過程をMacroで記録してそれを後からRunしても、出力される画像にはROIのデータが載っていない。もしかしたら、出力の際の[Insert Overlays]の設定がマクロで記録したコマンドからだとできないのかもしれない。
ROIの部分だけバイナリ化して出力までの作業をMacroで記録しても出力される画像にはバイナリはおろかROIすら載っていない。また、途中のバイナリ化作業はGUI上で動いている様子を見る分には行われているようだが、バイナリ化が適用されているのはROI内ではなく画面全体になっている。
この辺りの細かい設定はNIS-ElementのMacro言語でできるのだろうか。どうもそこまでの機能がNIS-Elementに備わっているような気がしない。
Helpを見るに、Thresholdの設定の仕方もバリエーションに応じて幾つかコマンドが用意されているようだが、Thresholdの適用範囲を設定したROI内に限定する、といったようなパラメーターを設定できるコマンドは存在しなかった。